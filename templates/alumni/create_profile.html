{% extends "base.html" %}

{% block title %}Create Your Profile - Alumni Platform{% endblock %}

{% block content %}
<div class="onboarding-container">
    <div class="onboarding-header">
        <h1>Welcome to the Alumni Network!</h1>
        <p>Let's set up your profile to connect you with fellow alumni</p>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <small>Complete your profile to access the platform</small>
    </div>

    <form method="POST" class="profile-creation-form" id="profileForm">
        <div class="form-sections">
            <!-- Personal Information -->
            <div class="form-section active" id="section-1">
                <div class="section-header">
                    <h3><i class="fas fa-user"></i> Personal Information</h3>
                    <p>Tell us about yourself</p>
                </div>
                
                <div class="form-group">
                    <label for="name">Full Name *</label>
                    <input type="text" id="name" name="name" required>
                    <small>Enter your full name as you'd like it to appear</small>
                </div>
                
                <div class="form-group">
                    <label for="linkedin_url">LinkedIn Profile (Optional)</label>
                    <input type="url" id="linkedin_url" name="linkedin_url" 
                           placeholder="https://linkedin.com/in/yourprofile">
                    <small>Your LinkedIn profile helps alumni connect with you professionally (optional)</small>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="batch_year">Batch Year *</label>
                        <select id="batch_year" name="batch_year" required>
                            <option value="">Select Year</option>
                            {% for year in range(1990, 2026) %}
                            <option value="{{ year }}">{{ year }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="department">Department *</label>
                        <select id="department" name="department" required>
                            <option value="">Select Department</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Electronics">Electronics & Communication</option>
                            <option value="Mechanical">Mechanical Engineering</option>
                            <option value="Civil">Civil Engineering</option>
                            <option value="Electrical">Electrical Engineering</option>
                            <option value="Chemical">Chemical Engineering</option>
                            <option value="Information Technology">Information Technology</option>
                            <option value="Biotechnology">Biotechnology</option>
                            <option value="Aerospace">Aerospace Engineering</option>
                            <option value="Business Administration">Business Administration</option>
                            <option value="Economics">Economics</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Physics">Physics</option>
                            <option value="Chemistry">Chemistry</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div class="section-actions">
                    <button type="button" class="btn btn-primary" onclick="nextSection()">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Professional Status -->
            <div class="form-section" id="section-2">
                <div class="section-header">
                    <h3><i class="fas fa-briefcase"></i> Professional Status</h3>
                    <p>Let us know about your current situation</p>
                </div>
                
                <div class="form-group">
                    <label>Current Job Status *</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="has_job" value="yes" required>
                            <span class="radio-custom"></span>
                            Yes, I'm currently employed
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="has_job" value="no" required>
                            <span class="radio-custom"></span>
                            No, I'm currently a student or seeking employment
                        </label>
                    </div>
                </div>

                <!-- Job Details (shown when "Yes" is selected) -->
                <div id="job-details" class="job-details" style="display: none;">
                    <div class="form-group">
                        <label for="current_job">Job Title *</label>
                        <input type="text" id="current_job" name="current_job" 
                               placeholder="e.g., Software Engineer, Marketing Manager">
                    </div>
                    
                    <div class="form-group">
                        <label for="company">Company Name *</label>
                        <input type="text" id="company" name="company" 
                               placeholder="e.g., Google, Microsoft, Local Business">
                    </div>
                    
                    <div class="form-group">
                        <label for="location">Company Location *</label>
                        <input type="text" id="location" name="location" 
                               placeholder="e.g., San Francisco, CA or Remote">
                    </div>
                </div>

                <!-- Student Status (shown when "No" is selected) -->
                <div id="student-details" class="student-details" style="display: none;">
                    <div class="status-info">
                        <i class="fas fa-graduation-cap"></i>
                        <h4>Student Status</h4>
                        <p>Your profile will show you as currently pursuing studies or seeking employment opportunities.</p>
                    </div>
                </div>
                
                <div class="section-actions">
                    <button type="button" class="btn btn-secondary" onclick="prevSection()">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button type="button" class="btn btn-primary" onclick="nextSection()">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Review & Submit -->
            <div class="form-section" id="section-3">
                <div class="section-header">
                    <h3><i class="fas fa-check-circle"></i> Review Your Profile</h3>
                    <p>Please review your information before submitting</p>
                </div>
                
                <div class="profile-preview">
                    <div class="preview-section">
                        <h4>Personal Information</h4>
                        <div class="preview-item">
                            <strong>Name:</strong> <span id="preview-name">-</span>
                        </div>
                        <div class="preview-item">
                            <strong>LinkedIn:</strong> <span id="preview-linkedin">-</span>
                        </div>
                        <div class="preview-item">
                            <strong>Batch Year:</strong> <span id="preview-batch">-</span>
                        </div>
                        <div class="preview-item">
                            <strong>Department:</strong> <span id="preview-department">-</span>
                        </div>
                    </div>
                    
                    <div class="preview-section">
                        <h4>Professional Status</h4>
                        <div id="preview-professional">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="terms_accepted" required>
                        I agree to the platform's terms of service and privacy policy
                    </label>
                </div>
                
                <div class="section-actions">
                    <button type="button" class="btn btn-secondary" onclick="prevSection()">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-check"></i> Create Profile
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<style>
.onboarding-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    min-height: 100vh;
}

.onboarding-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
}

.onboarding-header h1 {
    margin-bottom: 10px;
    font-size: 2.2rem;
}

.onboarding-header p {
    margin-bottom: 20px;
    opacity: 0.9;
}

.progress-bar {
    width: 100%;
    height: 6px;
    background: rgba(255,255,255,0.3);
    border-radius: 3px;
    margin-bottom: 10px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: white;
    border-radius: 3px;
    width: 33.33%;
    transition: width 0.3s ease;
}

.profile-creation-form {
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    overflow: hidden;
}

.form-section {
    display: none;
    padding: 40px;
    min-height: 500px;
}

.form-section.active {
    display: block;
}

.section-header {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 2px solid #f0f0f0;
}

.section-header h3 {
    color: #333;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.section-header p {
    color: #666;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.form-group {
    margin-bottom: 25px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-group small {
    display: block;
    margin-top: 5px;
    color: #666;
    font-size: 14px;
}

.radio-group {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.radio-label {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    padding: 15px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    transition: all 0.3s;
}

.radio-label:hover {
    border-color: #667eea;
    background: #f8f9ff;
}

.radio-label input[type="radio"] {
    display: none;
}

.radio-custom {
    width: 20px;
    height: 20px;
    border: 2px solid #ddd;
    border-radius: 50%;
    position: relative;
    transition: all 0.3s;
}

.radio-label input[type="radio"]:checked + .radio-custom {
    border-color: #667eea;
    background: #667eea;
}

.radio-label input[type="radio"]:checked + .radio-custom::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
}

.job-details,
.student-details {
    margin-top: 25px;
    padding: 25px;
    background: #f8f9ff;
    border-radius: 10px;
    border-left: 4px solid #667eea;
}

.status-info {
    text-align: center;
    color: #667eea;
}

.status-info i {
    font-size: 3rem;
    margin-bottom: 15px;
}

.status-info h4 {
    margin-bottom: 10px;
    color: #333;
}

.profile-preview {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 25px;
}

.preview-section {
    margin-bottom: 25px;
}

.preview-section:last-child {
    margin-bottom: 0;
}

.preview-section h4 {
    color: #333;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #dee2e6;
}

.preview-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.preview-item:last-child {
    border-bottom: none;
}

.checkbox-label {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    cursor: pointer;
    line-height: 1.5;
}

.checkbox-label input[type="checkbox"] {
    width: auto;
    margin: 0;
}



.section-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 40px;
    padding-top: 25px;
    border-top: 2px solid #f0f0f0;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
}

.btn-primary {
    background: #667eea;
    color: white;
}

.btn-primary:hover {
    background: #5a67d8;
    transform: translateY(-2px);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
    transform: translateY(-2px);
}

.btn-success {
    background: #28a745;
    color: white;
}

.btn-success:hover {
    background: #218838;
    transform: translateY(-2px);
}

@media (max-width: 768px) {
    .onboarding-container {
        padding: 10px;
    }
    
    .form-section {
        padding: 20px;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .section-actions {
        flex-direction: column;
        gap: 15px;
    }
    
    .btn {
        width: 100%;
        justify-content: center;
    }
}
</style>

<script>
let currentSection = 1;
const totalSections = 3;

// Job status radio button handling
document.addEventListener('DOMContentLoaded', function() {
    const jobRadios = document.querySelectorAll('input[name="has_job"]');
    const jobDetails = document.getElementById('job-details');
    const studentDetails = document.getElementById('student-details');
    
    jobRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.value === 'yes') {
                jobDetails.style.display = 'block';
                studentDetails.style.display = 'none';
                
                // Make job fields required
                document.getElementById('current_job').required = true;
                document.getElementById('company').required = true;
                document.getElementById('location').required = true;
            } else {
                jobDetails.style.display = 'none';
                studentDetails.style.display = 'block';
                
                // Remove job field requirements
                document.getElementById('current_job').required = false;
                document.getElementById('company').required = false;
                document.getElementById('location').required = false;
                
                // Clear job field values
                document.getElementById('current_job').value = '';
                document.getElementById('company').value = '';
                document.getElementById('location').value = '';
            }
            updatePreview();
        });
    });
    
    // Update preview when fields change
    const formInputs = document.querySelectorAll('input, select');
    formInputs.forEach(input => {
        input.addEventListener('change', updatePreview);
        input.addEventListener('input', updatePreview);
    });
});

function nextSection() {
    if (validateCurrentSection()) {
        if (currentSection < totalSections) {
            document.getElementById(`section-${currentSection}`).classList.remove('active');
            currentSection++;
            document.getElementById(`section-${currentSection}`).classList.add('active');
            updateProgressBar();
            updatePreview();
        }
    }
}

function prevSection() {
    if (currentSection > 1) {
        document.getElementById(`section-${currentSection}`).classList.remove('active');
        currentSection--;
        document.getElementById(`section-${currentSection}`).classList.add('active');
        updateProgressBar();
    }
}

function updateProgressBar() {
    const progressFill = document.querySelector('.progress-fill');
    const progress = (currentSection / totalSections) * 100;
    progressFill.style.width = progress + '%';
}

function validateCurrentSection() {
    const currentSectionElement = document.getElementById(`section-${currentSection}`);
    const requiredFields = currentSectionElement.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.style.borderColor = '#dc3545';
            isValid = false;
            
            // Show error message
            let errorMsg = field.parentNode.querySelector('.error-message');
            if (!errorMsg) {
                errorMsg = document.createElement('small');
                errorMsg.className = 'error-message';
                errorMsg.style.color = '#dc3545';
                errorMsg.style.marginTop = '5px';
                errorMsg.style.display = 'block';
                field.parentNode.appendChild(errorMsg);
            }
            errorMsg.textContent = 'This field is required';
        } else {
            field.style.borderColor = '#e1e5e9';
            const errorMsg = field.parentNode.querySelector('.error-message');
            if (errorMsg) {
                errorMsg.remove();
            }
        }
    });
    
    // Special validation for LinkedIn URL
    const linkedinField = document.getElementById('linkedin_url');
    if (linkedinField && linkedinField.value) {
        const linkedinPattern = /^https:\/\/(www\.)?linkedin\.com\/in\/[a-zA-Z0-9-]+\/?$/;
        if (!linkedinPattern.test(linkedinField.value)) {
            linkedinField.style.borderColor = '#dc3545';
            let errorMsg = linkedinField.parentNode.querySelector('.error-message');
            if (!errorMsg) {
                errorMsg = document.createElement('small');
                errorMsg.className = 'error-message';
                errorMsg.style.color = '#dc3545';
                errorMsg.style.marginTop = '5px';
                errorMsg.style.display = 'block';
                linkedinField.parentNode.appendChild(errorMsg);
            }
            errorMsg.textContent = 'Please enter a valid LinkedIn profile URL';
            isValid = false;
        }
    }
    
    if (!isValid) {
        showNotification('Please fill in all required fields correctly', 'error');
    }
    
    return isValid;
}

function updatePreview() {
    // Personal Information
    document.getElementById('preview-name').textContent = 
        document.getElementById('name').value || '-';
    document.getElementById('preview-linkedin').textContent = 
        document.getElementById('linkedin_url').value || '-';
    document.getElementById('preview-batch').textContent = 
        document.getElementById('batch_year').value || '-';
    document.getElementById('preview-department').textContent = 
        document.getElementById('department').value || '-';
    
    // Professional Status
    const hasJob = document.querySelector('input[name="has_job"]:checked');
    const professionalPreview = document.getElementById('preview-professional');
    
    if (hasJob) {
        if (hasJob.value === 'yes') {
            const jobTitle = document.getElementById('current_job').value || '-';
            const company = document.getElementById('company').value || '-';
            const location = document.getElementById('location').value || '-';
            
            professionalPreview.innerHTML = `
                <div class="preview-item">
                    <strong>Status:</strong> <span>Currently Employed</span>
                </div>
                <div class="preview-item">
                    <strong>Job Title:</strong> <span>${jobTitle}</span>
                </div>
                <div class="preview-item">
                    <strong>Company:</strong> <span>${company}</span>
                </div>
                <div class="preview-item">
                    <strong>Location:</strong> <span>${location}</span>
                </div>
            `;
        } else {
            professionalPreview.innerHTML = `
                <div class="preview-item">
                    <strong>Status:</strong> <span>Student / Seeking Employment</span>
                </div>
            `;
        }
    } else {
        professionalPreview.innerHTML = `
            <div class="preview-item">
                <strong>Status:</strong> <span>Not specified</span>
            </div>
        `;
    }
}

// Form submission
document.getElementById('profileForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (!validateCurrentSection()) {
        return;
    }
    
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Profile...';
    
    // Submit the form
    const formData = new FormData(this);
    
    fetch('{{ url_for("create_profile") }}', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification('Profile created successfully! Redirecting to dashboard...', 'success');
            setTimeout(() => {
                window.location.href = data.redirect_url;
            }, 2000);
        } else {
            showNotification(data.message || 'Error creating profile', 'error');
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }
    })
    .catch(error => {
        showNotification('Error creating profile. Please try again.', 'error');
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    });
});

// Notification function
function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => notification.classList.add('show'), 100);
    
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
    }, 5000);
}
</script>

<!-- Notification Styles -->
<style>
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    padding: 16px;
    z-index: 10000;
    transform: translateX(400px);
    transition: transform 0.3s ease;
    max-width: 400px;
    border-left: 4px solid #667eea;
}

.notification.show {
    transform: translateX(0);
}

.notification-success {
    border-left-color: #28a745;
}

.notification-error {
    border-left-color: #dc3545;
}

.notification-content {
    display: flex;
    align-items: center;
    gap: 12px;
}

.notification-content i {
    font-size: 16px;
}

.notification-success .notification-content i {
    color: #28a745;
}

.notification-error .notification-content i {
    color: #dc3545;
}

.error-message {
    color: #dc3545 !important;
    font-size: 12px !important;
    margin-top: 5px !important;
    display: block !important;
}
</style>
{% endblock %}