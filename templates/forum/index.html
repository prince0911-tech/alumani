{% extends "base.html" %}

{% block title %}Discussion Forum{% endblock %}

{% block content %}
<div class="forum-container">
    <div class="forum-header">
        <h1>Discussion Forum</h1>
        <p>Connect and engage with fellow alumni through meaningful discussions</p>
        
        <div class="header-actions">
            <button class="btn btn-primary" onclick="openModal('createPostModal')">
                <i class="fas fa-plus"></i> New Discussion
            </button>
        </div>
    </div>

    <!-- Forum Stats -->
    <div class="forum-stats">
        <div class="stat-item">
            <i class="fas fa-comments"></i>
            <span>{{ posts|length }} Discussions</span>
        </div>
        <div class="stat-item">
            <i class="fas fa-users"></i>
            <span>Active Community</span>
        </div>
        <div class="stat-item">
            <i class="fas fa-clock"></i>
            <span>24/7 Support</span>
        </div>
    </div>

    <!-- Forum Posts -->
    <div class="forum-posts">
        {% if posts %}
            {% for post in posts %}
            <div class="post-card">
                <div class="post-header">
                    <div class="post-author">
                        <div class="author-avatar">
                            {{ post.author_name[0].upper() if post.author_name else 'A' }}
                        </div>
                        <div class="author-info">
                            <h4>{{ post.author_name or 'Anonymous' }}</h4>
                            <small>{{ post.created_at.strftime('%B %d, %Y at %I:%M %p') }}</small>
                        </div>
                    </div>
                    
                    <div class="post-stats">
                        <span class="comment-count">
                            <i class="fas fa-comments"></i>
                            {{ post.comment_count }} replies
                        </span>
                    </div>
                </div>
                
                <div class="post-content">
                    <h3><a href="{{ url_for('forum_post', post_id=post.id) }}">{{ post.title }}</a></h3>
                    <p>{{ post.content[:200] }}{% if post.content|length > 200 %}...{% endif %}</p>
                </div>
                
                <div class="post-actions">
                    <a href="{{ url_for('forum_post', post_id=post.id) }}" class="btn btn-secondary btn-sm">
                        <i class="fas fa-eye"></i> View Discussion
                    </a>
                    <button class="btn btn-secondary btn-sm" onclick="likePost({{ post.id }})">
                        <i class="far fa-heart"></i> Like
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="sharePost({{ post.id }})">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="no-posts">
                <i class="fas fa-comments"></i>
                <h3>No discussions yet</h3>
                <p>Be the first to start a meaningful discussion with fellow alumni!</p>
                <button class="btn btn-primary" onclick="openModal('createPostModal')">
                    <i class="fas fa-plus"></i> Start Discussion
                </button>
            </div>
        {% endif %}
    </div>
</div>

<!-- Create Post Modal -->
<div id="createPostModal" class="modal">
    <div class="modal-overlay" onclick="closeModal('createPostModal')"></div>
    <div class="modal-content large">
        <div class="modal-header">
            <h3>Start a New Discussion</h3>
            <button class="modal-close" onclick="closeModal('createPostModal')">&times;</button>
        </div>
        <form id="createPostForm">
            <div class="form-group">
                <label for="postTitle">Discussion Title *</label>
                <input type="text" id="postTitle" name="title" required placeholder="What would you like to discuss?">
            </div>
            
            <div class="form-group">
                <label for="postContent">Content *</label>
                <textarea id="postContent" name="content" rows="8" required 
                    placeholder="Share your thoughts, ask questions, or start a meaningful conversation..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="postCategory">Category</label>
                <select id="postCategory" name="category">
                    <option value="">General Discussion</option>
                    <option value="career">Career Advice</option>
                    <option value="networking">Networking</option>
                    <option value="industry">Industry Insights</option>
                    <option value="college">College Memories</option>
                    <option value="achievements">Achievements</option>
                    <option value="help">Help & Support</option>
                </select>
            </div>
            
            <div class="modal-actions">
                <button type="submit" class="btn btn-primary">Post Discussion</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal('createPostModal')">Cancel</button>
            </div>
        </form>
    </div>
</div>

<style>
.forum-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 20px;
}

.forum-header {
    text-align: center;
    margin-bottom: 40px;
    position: relative;
}

.header-actions {
    position: absolute;
    top: 0;
    right: 0;
}

.forum-stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-bottom: 40px;
    padding: 20px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #667eea;
    font-weight: 500;
}

.stat-item i {
    font-size: 1.2rem;
}

.forum-posts {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.post-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    transition: transform 0.3s;
}

.post-card:hover {
    transform: translateY(-2px);
}

.post-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.post-author {
    display: flex;
    align-items: center;
    gap: 15px;
}

.author-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
}

.author-info h4 {
    color: #333;
    margin-bottom: 2px;
}

.author-info small {
    color: #666;
}

.post-stats {
    display: flex;
    align-items: center;
    gap: 15px;
}

.comment-count {
    color: #667eea;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 5px;
}

.post-content {
    margin-bottom: 20px;
}

.post-content h3 {
    margin-bottom: 10px;
}

.post-content h3 a {
    color: #333;
    text-decoration: none;
    transition: color 0.3s;
}

.post-content h3 a:hover {
    color: #667eea;
}

.post-content p {
    color: #666;
    line-height: 1.6;
}

.post-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.no-posts {
    text-align: center;
    padding: 60px 20px;
    color: #666;
}

.no-posts i {
    font-size: 4rem;
    margin-bottom: 20px;
    color: #ddd;
}

@media (max-width: 768px) {
    .header-actions {
        position: static;
        margin-top: 20px;
    }
    
    .forum-stats {
        flex-direction: column;
        align-items: center;
        gap: 20px;
    }
    
    .post-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .post-actions {
        justify-content: center;
    }
}
</style>

<script>
function likePost(postId) {
    const btn = event.target;
    const icon = btn.querySelector('i');
    
    if (icon.classList.contains('far')) {
        icon.classList.remove('far');
        icon.classList.add('fas');
        btn.innerHTML = '<i class="fas fa-heart"></i> Liked';
        btn.classList.add('btn-primary');
        btn.classList.remove('btn-secondary');
        showNotification('Post liked!', 'success');
    } else {
        icon.classList.remove('fas');
        icon.classList.add('far');
        btn.innerHTML = '<i class="far fa-heart"></i> Like';
        btn.classList.add('btn-secondary');
        btn.classList.remove('btn-primary');
        showNotification('Like removed', 'info');
    }
}

function sharePost(postId) {
    if (navigator.share) {
        navigator.share({
            title: 'Alumni Forum Discussion',
            text: 'Check out this discussion from our alumni forum!',
            url: window.location.href
        });
    } else {
        navigator.clipboard.writeText(window.location.href);
        showNotification('Discussion link copied to clipboard!', 'success');
    }
}

// Create Post Form
document.getElementById('createPostForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const title = document.getElementById('postTitle').value;
    const content = document.getElementById('postContent').value;
    
    if (!title.trim() || !content.trim()) {
        showNotification('Please fill in all required fields', 'error');
        return;
    }
    
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    showLoading(submitBtn);
    
    setTimeout(() => {
        hideLoading(submitBtn, originalText);
        showNotification('Discussion posted successfully!', 'success');
        closeModal('createPostModal');
        this.reset();
        
        // Simulate page refresh
        setTimeout(() => {
            location.reload();
        }, 1500);
    }, 2000);
});
</script>
{% endblock %}